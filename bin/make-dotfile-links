#!/bin/sh

host=`hostname | sed 's/\..*//'`

if [ "x$host" = "x" ]; then
	echo "can't determine hostname"
	exit 1
fi

if  [ ! -d .dotfiles ]; then
	echo ".dotfiles directory doesn't exist"
	exit 1
fi

echo "Making links for $host..."

#
# first the easy ones
#
for f in bin elisp ; do
	echo .dotfiles/$f
	rm -rf $f
	ln -s .dotfiles/$f $f
done

makelinks() {
	dir=$1

	for f in `cd $dir && ls -1d .* | grep -v ".#"` ; do
		[ $f = "." ] && continue
		[ $f = ".." ] && continue
		[ -f $dir/$host/$f ] && continue ; # hack, works for toplevel
	
		rm -rf $f
		ln -s $dir/$f $f
		echo $dir/$f
	done
}

makelinks .dotfiles

if [ -d .dotfiles/$host ]; then
	makelinks .dotfiles/$host
fi

